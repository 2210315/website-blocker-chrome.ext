<script src="js/common.js"></script>
<script src="js/utils.js"></script>
<script src="js/functions.js"></script>
<script src="js/website-blocker.js"></script>
<script>

    var afterFunction = null;
    var WB = new WebsiteBlocker();

    chrome.tabs.onCreated.addListener(function(tab) {
//        console.log('tabs.onCreated: ' + tab.url);
        WB.run(tab);
    });

    chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
//        console.log('tabs.onUpdated ' + tab.url);
        if (changeInfo.status === 'loading') {
            WB.run(tab);
        }
    });

    function getUrl(callback) {
        chrome.tabs.getSelected(null, function(tab) {
            if (tab.url) {
                afterFunction = callback;
                try {
                    chrome.tabs.executeScript(null, { file: 'js/injection.js' });
                }
                catch (e) {}
            }
            else {
                callback(null);
            }
        });
    };

    chrome.extension.onRequest.addListener(function(tab) {
//        console.log(tab);
        afterFunction(tab);
    });

</script>
